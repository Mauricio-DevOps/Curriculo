@{
    ViewData["Title"] = "Mauricio Naves Marques";
}

<section class="hero-section">
    <div class="hero-text">
        <p class="intro-label">Ol√°, eu sou</p>
        <h1>Mauricio Naves Marques</h1>
        <p class="hero-role">Analista de Desenvolvimento <span>S√™nior</span></p>
        <p class="hero-description">
            Bem-vindo ao meu portf√≥lio! Atuo no desenvolvimento de solu√ß√µes com foco em Intelig√™ncia Artificial, ajudando empresas que t√™m tecnologia e inova√ß√£o em seu DNA a transformarem ideias em produtos digitais com efici√™ncia, qualidade e impacto. Quer saber um pouco mais sobre mim? Converse com meu agente de IA no menu
            <a class="hero-chatbot-link" asp-controller="Home" asp-action="ChatBot">ChatBot</a>.
        </p>
        <div class="hero-actions">
            <a class="btn primary" asp-controller="Home" asp-action="Sobre">Sobre Mim</a>
            <a class="btn secondary" asp-controller="Home" asp-action="Contato">Entre em Contato</a>
            <a class="btn secondary download" href="~/docs/CV_Maur?cioNavesMarques.pdf" download>Baixar Curr?culo</a>
        </div>
        <div class="hero-social-links" aria-label="Redes sociais">
            <a class="social-link instagram" href="https://www.instagram.com/mauricio.naves/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                <svg aria-hidden="true" viewBox="0 0 24 24" focusable="false">
                    <path d="M7.001 2C4.243 2 2 4.243 2 7.001v9.998C2 19.757 4.243 22 7.001 22h9.998C19.757 22 22 19.757 22 17V7c0-2.757-2.243-5-5.001-5H7.001zm0 2h9.998A3 3 0 0 1 20 7v9.998A3 3 0 0 1 17 20H7.001A3 3 0 0 1 4 16.998V7A3 3 0 0 1 7.001 4zm12 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zM12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6z" />
                </svg>
            </a>
            <a class="social-link facebook" href="https://www.facebook.com/mauricionavesmarques" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                <svg aria-hidden="true" viewBox="0 0 24 24" focusable="false">
                    <path d="M22 12a10 10 0 1 0-11.5 9.9v-7h-2v-3h2V9.6c0-2 1.2-3.1 3-3.1.9 0 1.8.1 2 .1v2.2h-1.1c-1.1 0-1.4.7-1.4 1.4V12h2.5l-.4 3h-2.1v7A10 10 0 0 0 22 12z" />
                </svg>
            </a>
            <a class="social-link linkedin" href="https://www.linkedin.com/in/maur%C3%ADcio-naves/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                <svg aria-hidden="true" viewBox="0 0 24 24" focusable="false">
                    <path d="M22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.226.792 24 1.771 24h20.454C23.205 24 24 23.226 24 22.271V1.729C24 .774 23.205 0 22.225 0zM7.056 20.452H3.72V9h3.336v11.452zM5.388 7.433a1.936 1.936 0 1 1 0-3.872 1.936 1.936 0 0 1 0 3.872zM20.452 20.452h-3.334v-5.576c0-1.33-.024-3.038-1.85-3.038-1.85 0-2.134 1.445-2.134 2.94v5.674h-3.334V9h3.2v1.561h.046c.446-.846 1.538-1.736 3.165-1.736 3.384 0 4.007 2.229 4.007 5.128v6.499z" />
                </svg>
            </a>
            <a class="social-link github" href="https://github.com/Mauricio-DevOps" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
                <svg aria-hidden="true" viewBox="0 0 24 24" focusable="false">
                    <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.387.6.113.82-.26.82-.577v-2.234c-3.338.726-4.033-1.415-4.033-1.415-.546-1.387-1.333-1.758-1.333-1.758-1.09-.745.083-.73.083-.73 1.205.086 1.84 1.238 1.84 1.238 1.07 1.834 2.809 1.304 3.495.997.108-.776.417-1.305.76-1.605-2.665-.304-5.466-1.332-5.466-5.931 0-1.31.465-2.381 1.235-3.221-.124-.303-.536-1.524.117-3.176 0 0 1.008-.322 3.3 1.23a11.52 11.52 0 0 1 6 0c2.29-1.552 3.297-1.23 3.297-1.23.655 1.652.243 2.873.12 3.176.77.84 1.233 1.911 1.233 3.221 0 4.61-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .32.218.694.825.576C20.565 22.092 24 17.592 24 12.297 24 5.67 18.627.297 12 .297z" />
                </svg>
            </a>
            <a class="social-link whatsapp" href="https://wa.me/qr/SQ6RBHDXWO2ZO1" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
                <svg aria-hidden="true" viewBox="0 0 24 24" focusable="false">
                    <path d="M20.52 3.48A11.8 11.8 0 0 0 12.01 1C6.17 1 1.34 5.82 1.33 11.66a11.6 11.6 0 0 0 1.68 5.95L1 23l5.55-1.74A11.8 11.8 0 0 0 12.01 23c6.84 0 11.69-4.84 11.69-10.68a11.7 11.7 0 0 0-3.18-8.84zm-8.51 17a9.6 9.6 0 0 1-4.9-1.34l-.35-.21-3.29 1.03.98-3.47-.23-.36a9.53 9.53 0 0 1-1.5-5.2c0-5.27 4.33-9.56 9.62-9.56 2.57 0 4.99 1 6.81 2.82a9.5 9.5 0 0 1 2.81 6.77c-.01 5.28-4.34 9.52-9.65 9.52zm5.29-7.17c-.29-.15-1.7-.84-1.97-.94-.27-.1-.47-.15-.67.16-.2.31-.77.94-.94 1.13-.17.2-.35.21-.65.06-.29-.14-1.24-.46-2.36-1.46-.87-.76-1.46-1.7-1.63-1.99-.17-.29-.02-.45.13-.59.13-.13.29-.35.43-.53.14-.18.19-.31.29-.52.1-.21.05-.39-.03-.54-.08-.15-.67-1.6-.92-2.2-.24-.58-.48-.5-.67-.51l-.57-.01c-.2 0-.52.07-.79.37-.27.3-1.04 1-1.04 2.44 0 1.44 1.07 2.84 1.22 3.04.15.2 2.11 3.3 5.1 4.62.71.31 1.27.5 1.7.64.71.22 1.36.19 1.87.12.57-.08 1.7-.69 1.94-1.36.24-.67.24-1.25.17-1.37-.07-.12-.27-.2-.56-.35z" />
                </svg>
            </a>
        </div>


    </div>
    <div class="hero-visual">
        <div class="profile-wrap">
            <div class="glow"></div>

            <div class="profile-card">
                <div class="profile-accent"></div>

                <div class="profile-media">
                    <img src="~/images/Foto.jpeg" alt="Retrato de Mauricio Naves Marques" />
                    <span>BELO HORIZONTE, MINAS GERAIS</span>
                </div>
            </div>
        </div>
    </div>


</section>

<section class="featured-section" id="projetos">
    <div class="section-header">
        <p>Projetos em Destaque</p>
        <h2>Algumas das minhas solu√ß√µes em produ√ß√£o</h2>
    </div>
    @{
        var featuredProjects = new[]
        {
            new
            {
                Title = "GameBock",
                Description = "Um projeto para criar e ler livros interativos.",
                Image = Url.Content("~/images/Gameboock.png"),
                Link = "https://gameboock-mauricio-dev-hedrbshjfmgnendp.brazilsouth-01.azurewebsites.net"
            },
            new
            {
                Title = "Curr√≠culo",
                Description = "Um projeto para me apresentar de forma profissional e dar visibilidade aos meus projetos.",
                Image = Url.Content("~/images/Curriculo.png"),
                Link = "https://curriculo-mauricio-dev-hcajgtgafjhmfegk.brazilsouth-01.azurewebsites.net"
            },
            new
            {
                Title = "Curso de Ingl√™s",
                Description = "Um sistema para cadastro de alunos e de material para curso de ingl√™s.",
                Image = Url.Content("~/images/AulaIngles.png"),
                Link = "https://auladeingles-mauricio-dev-f7f3cea2f3bxcxgf.brazilsouth-01.azurewebsites.net"
            }
        };
    }
    <div class="project-grid">
        @foreach (var project in featuredProjects)
        {
            <a class="project-card" href="@project.Link" target="_blank" rel="noopener noreferrer">
                <div class="project-icon">
                    <span></span>
                </div>
                <h3>@project.Title</h3>
                <p>@project.Description</p>
                <span class="link">Ver Projeto ‚Üí</span>
            </a>
        }
    </div>
</section>

@* <div class="chat-widget" data-chatkit-launcher>
    <button class="chat-toggle" type="button" aria-label="Abrir chat" aria-expanded="false">
        <span>ü§ñ</span>
    </button>
    <div class="chat-panel" aria-live="polite">
        <header>
            <div>
                <strong>Agende de Curr√≠culo</strong>
                <p>Workflow conectado ao ChatKit</p>
            </div>
            <button class="chat-close" type="button" aria-label="Fechar chat" data-chatkit-close>√ó</button>
        </header>
        <div class="chatkit-body">
            <openai-chatkit class="chatkit-frame" data-chatkit-element aria-live="polite"></openai-chatkit>
        </div>
        <div class="chatkit-controls">
            <button type="button" class="btn secondary" data-chatkit-refresh>Gerar nova sess√£o</button>
            <span class="chatkit-status" data-chatkit-status aria-live="polite">
                Clique no rob√¥ para abrir o chat.
            </span>
        </div>
    </div>
<div class="chatkit-backdrop" data-chatkit-backdrop></div>
</div> *@

@* <div class="assistant-chat" data-assistant-chat>
    <button class="assistant-toggle" type="button" aria-label="Abrir assistente" aria-expanded="false" data-assistant-toggle>
        <span aria-hidden="true">&#128172;</span>
        <span>Assistente IA</span>
    </button>
    <div class="assistant-panel" role="dialog" aria-label="Assistente IA" aria-hidden="true" data-assistant-panel>
        <header>
            <div>
                <strong>Assistente IA</strong>
                <p>Converse comigo sobre o curr√≠culo</p>
            </div>
            <button type="button" class="assistant-close" aria-label="Fechar assistente" data-assistant-close>&times;</button>
        </header>
        <div class="assistant-messages" data-assistant-messages role="log" aria-live="polite">
            <p class="assistant-placeholder" data-assistant-placeholder>Envie uma mensagem para iniciar a conversa.</p>
        </div>
        <form class="assistant-form" data-assistant-form>
            <textarea data-assistant-input placeholder="Digite sua mensagem..." aria-label="Mensagem para o assistente" rows="2" required></textarea>
            <div class="assistant-form-actions">
                <button type="submit" class="btn primary" data-assistant-submit>Enviar</button>
            </div>
        </form>
        <div class="assistant-status" data-assistant-status aria-live="polite"></div>
    </div>
</div> *@

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const wrapper = document.querySelector('[data-chatkit-launcher]');
            if (wrapper) {
                const toggle = wrapper.querySelector('.chat-toggle');
                const panel = wrapper.querySelector('.chat-panel');
                const closeBtn = wrapper.querySelector('[data-chatkit-close]');
                const backdrop = wrapper.querySelector('[data-chatkit-backdrop]');
                const element = wrapper.querySelector('[data-chatkit-element]');
                const refreshButton = wrapper.querySelector('[data-chatkit-refresh]');
                const statusElement = wrapper.querySelector('[data-chatkit-status]');

                if (element && window.customElements) {
                    const storageKey = 'chatkit-device-id';
                    let isMounting = false;
                    let listenersAttached = false;

                    const setStatus = (message, isError) => {
                        if (!statusElement) return;
                        statusElement.textContent = message || '';
                        statusElement.classList.toggle('error', Boolean(isError));
                    };

                    const getDeviceId = () => {
                        try {
                            const storage = window.localStorage;
                            if (!storage) throw new Error('No storage available');
                            let value = storage.getItem(storageKey);
                            if (!value) {
                                value = window.crypto?.randomUUID ? window.crypto.randomUUID() : `device-${Date.now()}`;
                                storage.setItem(storageKey, value);
                            }
                            return value;
                        } catch {
                            return window.crypto?.randomUUID ? window.crypto.randomUUID() : `device-${Date.now()}`;
                        }
                    };

                    const requestClientSecret = async () => {
                        const response = await fetch('/api/chatkit/session', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                deviceId: getDeviceId()
                            })
                        });

                        const raw = await response.text();
                        const payload = raw ? (() => {
                            try {
                                return JSON.parse(raw);
                            } catch {
                                return null;
                            }
                        })() : null;

                        if (!response.ok) {
                            const detail = payload?.detail || payload?.message || raw || 'Erro ao criar sess√£o do ChatKit.';
                            throw new Error(detail);
                        }

                        const secret = payload?.client_secret;
                        if (!secret) {
                            throw new Error('A resposta do ChatKit n√£o trouxe o client_secret.');
                        }

                        return secret;
                    };

                    const buildChatKitOptions = () => ({
                        api: {
                            async getClientSecret(existing) {
                                if (existing) {
                                    setStatus('Atualizando sess√£o do ChatKit...');
                                } else {
                                    setStatus('Criando sess√£o do ChatKit...');
                                }

                                try {
                                    const secret = await requestClientSecret();
                                    setStatus('Sess√£o ativa.');
                                    return secret;
                                } catch (error) {
                                    setStatus(error?.message || 'Erro ao obter client secret.', true);
                                    throw error;
                                }
                            }
                        },
                        theme: {
                            colorScheme: 'dark',
                            radius: 'pill',
                            density: 'normal',
                            color: {
                                accent: {
                                    primary: '#a52727',
                                    level: 1
                                }
                            },
                            typography: {
                                baseSize: 16,
                                fontFamily: '"OpenAI Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif',
                                fontFamilyMono: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "DejaVu Sans Mono", "Courier New", monospace',
                                fontSources: [
                                    {
                                        family: 'OpenAI Sans',
                                        src: 'https://cdn.openai.com/common/fonts/openai-sans/v2/OpenAISans-Regular.woff2',
                                        weight: 400,
                                        style: 'normal',
                                        display: 'swap'
                                    }
                                ]
                            }
                        },
                        composer: {
                            attachments: {
                                enabled: true,
                                maxCount: 5,
                                maxSize: 10485760
                            },
                            tools: [
                                {
                                    id: 'search_docs',
                                    label: 'Buscar documentos',
                                    shortLabel: 'Docs',
                                    placeholderOverride: 'Pesquisar documenta√ß√£o',
                                    icon: 'book-open',
                                    pinned: false
                                }
                            ]
                        },
                        startScreen: {
                            greeting: '',
                            prompts: [
                                {
                                    icon: 'circle-question',
                                    label: 'O que √© o ChatKit?',
                                    prompt: 'O que √© o ChatKit?'
                                },
                                {
                                    icon: 'circle-question',
                                    label: 'Resumo profissional',
                                    prompt: 'Fa√ßa um resumo profissional do Mauricio.'
                                },
                                {
                                    icon: 'circle-question',
                                    label: 'Destaques',
                                    prompt: 'Quais os principais destaques da carreira?'
                                }
                            ]
                        },
                        frameTitle: 'ChatKit - Fluxo do curr√≠culo'
                    });

                    const attachEventListeners = () => {
                        if (listenersAttached) return;

                        element.addEventListener('chatkit.ready', () => {
                            setStatus('ChatKit pronto para uso.');
                        });

                        element.addEventListener('chatkit.error', (event) => {
                            const detail = event?.detail?.error;
                            const message = typeof detail === 'string'
                                ? detail
                                : detail?.message || 'Erro inesperado no ChatKit.';
                            console.error('ChatKit error:', detail);
                            setStatus(message, true);
                        });

                        listenersAttached = true;
                    };

                    const mountChatKit = async () => {
                        if (isMounting) return;
                        isMounting = true;
                        attachEventListeners();
                        setStatus('Preparando ChatKit...');
                        try {
                            await window.customElements.whenDefined('openai-chatkit');
                            element.setOptions(buildChatKitOptions());
                        } catch (error) {
                            console.error('Erro ao inicializar o ChatKit:', error);
                            setStatus(error?.message || 'Erro ao iniciar o ChatKit.', true);
                        } finally {
                            isMounting = false;
                        }
                    };

                    const togglePanel = (state) => {
                        const nextState = state ?? !panel.classList.contains('open');
                        panel.classList.toggle('open', nextState);
                        backdrop?.classList.toggle('visible', nextState);
                        toggle?.setAttribute('aria-expanded', String(nextState));
                        if (nextState) {
                            mountChatKit();
                        }
                    };

                    toggle?.addEventListener('click', () => togglePanel());
                    closeBtn?.addEventListener('click', () => togglePanel(false));
                    backdrop?.addEventListener('click', () => togglePanel(false));

                    refreshButton?.addEventListener('click', () => {
                        mountChatKit();
                    });
                }
            }

            const assistantWrapper = document.querySelector('[data-assistant-chat]');
            if (assistantWrapper) {
                const assistantToggle = assistantWrapper.querySelector('[data-assistant-toggle]');
                const assistantPanel = assistantWrapper.querySelector('[data-assistant-panel]');
                const assistantClose = assistantWrapper.querySelector('[data-assistant-close]');
                const assistantMessages = assistantWrapper.querySelector('[data-assistant-messages]');
                const assistantPlaceholder = assistantWrapper.querySelector('[data-assistant-placeholder]');
                const assistantForm = assistantWrapper.querySelector('[data-assistant-form]');
                const assistantInput = assistantWrapper.querySelector('[data-assistant-input]');
                const assistantSubmit = assistantWrapper.querySelector('[data-assistant-submit]');
                const assistantStatus = assistantWrapper.querySelector('[data-assistant-status]');

                let isAssistantSending = false;
                let previousResponseId = null;

                const toggleAssistantPanel = (state) => {
                    const next = typeof state === 'boolean'
                        ? state
                        : !assistantWrapper.classList.contains('open');
                    assistantWrapper.classList.toggle('open', next);
                    assistantPanel?.setAttribute('aria-hidden', String(!next));
                    assistantToggle?.setAttribute('aria-expanded', String(next));
                    if (next) {
                        assistantInput?.focus();
                    }
                };

                const setAssistantStatus = (message, isError = false) => {
                    if (!assistantStatus) return;
                    assistantStatus.textContent = message || '';
                    assistantStatus.classList.toggle('error', Boolean(isError));
                };

                const appendAssistantMessage = (role, text) => {
                    if (!assistantMessages || !text) return;
                    assistantPlaceholder?.classList.add('hidden');
                    const bubble = document.createElement('div');
                    bubble.className = `assistant-bubble ${role}`;
                    bubble.textContent = text;
                    assistantMessages.appendChild(bubble);
                    assistantMessages.scrollTop = assistantMessages.scrollHeight;
                };

                const setAssistantLoading = (state) => {
                    isAssistantSending = state;
                    if (assistantInput) {
                        assistantInput.disabled = state;
                    }
                    if (assistantSubmit) {
                        assistantSubmit.disabled = state;
                    }
                    if (!state && assistantInput) {
                        assistantInput.focus();
                    }
                };

                assistantToggle?.addEventListener('click', () => toggleAssistantPanel());
                assistantClose?.addEventListener('click', () => toggleAssistantPanel(false));

                assistantForm?.addEventListener('submit', async (event) => {
                    event.preventDefault();
                    if (isAssistantSending) return;
                    const prompt = assistantInput?.value?.trim();
                    if (!prompt) return;

                    appendAssistantMessage('user', prompt);
                    assistantInput.value = '';
                    setAssistantLoading(true);
                    setAssistantStatus('Enviando mensagem...');

                    try {
                        const response = await fetch('/api/assistant-chat/message', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                prompt,
                                previousResponseId,
                                useFileSearch: true
                            })
                        });

                        const raw = await response.text();
                        let payload = null;
                        if (raw) {
                            try {
                                payload = JSON.parse(raw);
                            } catch {
                                payload = null;
                            }
                        }

                        if (!response.ok) {
                            throw new Error(payload?.message || raw || 'Erro ao enviar a mensagem.');
                        }

                        previousResponseId = payload?.responseId || null;
                        appendAssistantMessage('assistant', payload?.outputText || 'Sem resposta.');
                        setAssistantStatus('Resposta recebida.');
                    } catch (error) {
                        const fallback = error?.message || 'Erro inesperado.';
                        appendAssistantMessage('assistant', fallback);
                        setAssistantStatus(fallback, true);
                    } finally {
                        setAssistantLoading(false);
                    }
                });
            }
        });
    </script>
}
